x-healthcheck: &healthcheck
  test: ["CMD", "cloudflared", "tunnel", "--metrics", "localhost:8080", "ready"]
  interval: 30s
  timeout: 30s
  retries: 3
  start_period: 30s

services:
  cloudflared:
    image: cloudflare/cloudflared:2026.1.2
    container_name: cloudflared
    restart: on-failure
    command: tunnel --no-autoupdate run --token ${TUNNEL_TOKEN}
    ports:
      # metrics
      - "8080" 
    healthcheck: *healthcheck
    labels:
      - wud.tag.include=^\d+\.\d+\.\d+$$
      - homepage.group=Core
      - homepage.name=CloudFlared
      - homepage.icon=cloudflare.png
      - homepage.widget.type=cloudflared
      - homepage.widget.tunnelid=${TUNNEL_ID}
      - homepage.widget.accountid=${ACCOUNT_ID}
      - homepage.widget.key=${CF_KEY_TOKEN}
networks:
  default:
    name: internal
    external: true
